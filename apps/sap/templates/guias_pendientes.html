{% extends "base.html" %}
{% load static %}
{% load humanize %}
 
{% block extra_css %}
<style>
/* =========================================================
   üé® ESTILO CORPORATIVO ‚Äì Profesional, limpio y sobrio
========================================================= */

:root {
  --petroleo: #0a3d62;
  --petroleo-dark: #062b44;
  --gris-fondo: #f4f6f8;
  --gris-borde: #d2d6db;
  --gris-texto: #2c3e50;
  --gris-input: #c8d0d8;
  --gris-claro: #f9fafb;
}

/* ===== GLOBAL ===== */
body {
  background-color: var(--gris-fondo);
  color: var(--gris-texto);
  font-family: "Segoe UI", Roboto, Arial, sans-serif;
}

h3 {
  font-weight: 600;
  color: var(--petroleo);
  font-size: 1.35rem;
}

/* =========================================================
   üîç BUSCADOR COMPACTO CORPORATIVO
========================================================= */
.form-section {
  background: #ffffff;
  border: 1px solid var(--gris-borde);
  border-radius: 0.5rem;
  padding: 1rem 1.2rem;
  box-shadow: 0 1px 4px rgba(0,0,0,0.04);
  margin-bottom: 1.3rem;
}

label.form-label {
  font-size: 0.74rem;
  font-weight: 600;
  color: #34495e;
  margin-bottom: 0.2rem;
}

/* üòç ALTURA REAL DE INPUTS = 38px */
.form-control,
.form-select {
  border-radius: 0.35rem;
  border: 1px solid var(--gris-input);
  font-size: 0.85rem;
  height: 38px; /* <-- altura visual real */
  padding: 0.25rem 0.55rem;
  background-color: var(--gris-claro);
}

.form-control:focus,
.form-select:focus {
  border-color: var(--petroleo);
  box-shadow: 0 0 0 0.12rem rgba(10, 61, 98, 0.15);
}

/* =========================================================
   ‚≠ê BOTONES ‚Äî ALTURA EXACTA = 38px üü¶
========================================================= */

.btn-primary,
.btn-outline-secondary {
  height: 38px;           /* MISMA ALTURA QUE INPUT */
  padding: 0 1.1rem;
  font-size: 0.85rem;
  border-radius: 0.40rem; /* igual que inputs */
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.35rem;
  font-weight: 500;
}

.btn-primary {
  background-color: var(--petroleo);
  border-color: var(--petroleo);
}

.btn-primary:hover {
  background-color: var(--petroleo-dark);
  border-color: var(--petroleo-dark);
}

.btn-outline-secondary {
  background: white;
  border: 1px solid #bfc6cc;
  color: #34495e;
}

.btn-outline-secondary:hover {
  background: #eceff2;
  border-color: #b4bcc4;
}

/* =========================================================
   üìä TABLA TIPO EXCEL PROFESIONAL
========================================================= */

.table {
  border-collapse: separate;
  border-spacing: 0;
  background: #ffffff;
  width: 100%;
  border: 1px solid #d0d4d9;
  border-radius: 0.45rem;
  overflow: hidden;
  font-size: 0.84rem;
}

.table thead th {
  background: #e9edf2;
  color: #2b3b4d;
  font-weight: 600;
  font-size: 0.78rem;
  text-transform: uppercase;
  border-bottom: 1px solid #c9ced6;
  padding: 0.55rem 0.75rem;
  white-space: nowrap;
}

.table tbody tr {
  border-bottom: 1px solid #eceff3;
}

.table tbody tr:nth-child(even) {
  background: #f7f9fb;
}

.table tbody tr:hover {
  background-color: #e6eef7;
}

.table td {
  padding: 0.55rem 0.75rem;
  color: #2c3e50;
  border-right: 1px solid #eceff3;
}

.table td:last-child {
  border-right: none;
}

/* =========================================================
   üè∑ BADGES SOBRIAS
========================================================= */

.badge {
  padding: 0.28rem 0.48rem;
  font-size: 0.72rem;
  border-radius: 0.35rem;
  font-weight: 600;
}

.badge.bg-success { background-color: #2e7d59 !important; }
.badge.bg-danger { background-color: #b33939 !important; }
.badge.bg-warning { background-color: #d5b44c !important; color: #2b2b2b !important; }

/* =========================================================
   üö´ EMPTY STATE SOBRIO
========================================================= */

.empty-state {
  background: #fff;
  border: 1px dashed var(--gris-input);
  border-radius: 0.55rem;
  padding: 1.3rem;
  color: #5b6b79;
  font-size: 0.9rem;
}

/* Mobile */
@media (max-width: 576px) {
  th[data-short]::after { content: attr(data-short); }
  th span { display: none; }
}
</style>
{% endblock %}
 
{% block content %}
<div class="container py-4">

  <div class="d-flex align-items-center justify-content-between mb-3">
    <h3 class="mb-0">
      <i class="fa-solid fa-truck me-2" style="color: var(--petroleo);"></i>
      Gu√≠as Pendientes
    </h3>
  </div>
 
  <!-- üîç Filtros -->
  <form method="get" class="form-section">
    <div class="row g-2 align-items-end">

      <div class="col-12 col-md-3">
        <label class="form-label">Vendedor</label>
        <select name="vendedor" class="form-select">
          <option value="">-- Seleccione --</option>
          {% for v in vendedores %}
            <option value="{{ v }}" {% if vendedor == v %}selected{% endif %}>{{ v }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="col-6 col-md-2">
        <label class="form-label">Estado</label>
        <select name="estado" class="form-select">
          <option value="">-- Todos --</option>
          <option value="Packing"   {% if estado == "Packing" %}selected{% endif %}>Packing</option>
          <option value="En ruta"   {% if estado == "En ruta" %}selected{% endif %}>En ruta</option>
          <option value="Entregado" {% if estado == "Entregado" %}selected{% endif %}>Entregado</option>
        </select>
      </div>

      <div class="col-6 col-md-2">
        <label class="form-label">Desde</label>
        <input type="date" name="fecha_desde" class="form-control" value="{{ fecha_desde|default_if_none:'' }}">
      </div>

      <div class="col-6 col-md-2">
        <label class="form-label">Hasta</label>
        <input type="date" name="fecha_hasta" class="form-control" value="{{ fecha_hasta|default_if_none:'' }}">
      </div>

      <div class="col-12 col-md-3 text-md-end d-flex justify-content-md-end justify-content-start gap-2 mt-2 mt-md-0">
        <button type="submit" class="btn btn-primary">
          <i class="fa-solid fa-search"></i> Buscar
        </button>
        <a href="?" class="btn btn-outline-secondary">Limpiar</a>
      </div>

    </div>
  </form>
 
  {% if error %}
    <div class="alert alert-danger shadow-sm">{{ error }}</div>
  {% endif %}
 
  {% if data %}
    <div class="table-responsive">
      <table class="table align-middle">
        <thead>
          <tr>
            <th data-short="Doc#"><span>N¬∞ Documento</span></th>
            <th data-short="Gu√≠a#"><span>N¬∞ Gu√≠a</span></th>
            <th data-short="Fecha"><span>Fecha</span></th>
            <th data-short="Cliente"><span>Cliente</span></th>
            <th data-short="Neto"><span>Total Neto</span></th>
            <th data-short="Total"><span>Total</span></th>
            <th data-short="Recep."><span>Recepci√≥n</span></th>
            <th data-short="Vend."><span>Vendedor</span></th>
            <th data-short="OC"><span>Orden Compra</span></th>
            <th data-short="Estado"><span>Estado</span></th>
          </tr>
        </thead>
        <tbody>
          {% for guia in data %}
          <tr>
            <td>{{ guia.Numero_Documento }}</td>
            <td>{{ guia.Numero_Guia }}</td>
            <td>{{ guia.Fecha|date:"d/m/Y" }}</td>
            <td>{{ guia.Nombre_Cliente }}</td>
            <td>${{ guia.Total_Neto|floatformat:0|intcomma }}</td>
            <td>${{ guia.Total|floatformat:0|intcomma }}</td>
            <td>
              {% if guia.Recepcion == "NO" %}
                <span class="badge bg-danger">NO</span>
              {% else %}
                {% if guia.URL_Imagen_Entrega %}
                  <a href="{{ guia.URL_Imagen_Entrega }}" target="_blank">
                    <span class="badge bg-success">Entrega</span>
                  </a>
                {% else %}
                  <span class="badge bg-success">S√≠</span>
                {% endif %}
              {% endif %}
            </td>
            <td>{{ guia.Nombre_Vendedor }}</td>
            <td title="{{ guia.Orden_de_compra }}">{{ guia.Orden_de_compra }}</td>
            <td>
              {% if guia.Estado_Documento == "Packing" %}
                <span class="badge bg-warning">Packing</span>
              {% elif guia.Estado_Documento == "En ruta" %}
                <span class="badge bg-warning">En ruta</span>
              {% elif guia.Estado_Documento == "Entregado" %}
                <span class="badge bg-success">Entregado</span>
              {% else %}
                {{ guia.Estado_Documento }}
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
 
    <div class="mt-2 text-muted small">
      Mostrando {{ data|length }} gu√≠a{{ data|length|pluralize:"s" }}.
      {% if vendedor %}| Vendedor: <strong>{{ vendedor }}</strong>{% endif %}
      {% if estado %}| Estado: <strong>{{ estado }}</strong>{% endif %}
      {% if fecha_desde %}| Desde: <strong>{{ fecha_desde }}</strong>{% endif %}
      {% if fecha_hasta %}| Hasta: <strong>{{ fecha_hasta }}</strong>{% endif %}
    </div>

  {% else %}
    <div class="empty-state text-center mt-3">
      <i class="fa-regular fa-face-frown fa-2x mb-2"></i><br>
      No se encontraron resultados con los filtros seleccionados.
    </div>
  {% endif %}
</div>
{% endblock %}
