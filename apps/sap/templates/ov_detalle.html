{% extends "base.html" %}
{% load static %}
{% load custom_filters %}

{% block content %}
<style>
:root {
  --ink: #1c1c1c;
  --muted: #6c757d;
  --line: #dee2e6;
  --fill: #ffffff;
  --fill-soft: #f8f9fa;
  --primary: #0d6efd;
}
.page-header {
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 2px solid var(--line);
  padding-bottom: .75rem; margin-bottom: 1.5rem;
}
.page-title { margin: 0; font-size: 1.5rem; font-weight: 700; color: var(--ink); }
.ghost-btn {
  padding: .45rem .9rem; border: 1px solid var(--line);
  background: var(--fill); text-decoration: none; color: var(--ink);
  border-radius: 6px; font-size: .9rem; font-weight: 500;
  transition: all .2s ease;
}
.ghost-btn:hover { background: var(--fill-soft); color: var(--primary); }

.card {
  background: var(--fill); border: 1px solid var(--line); border-radius: 8px;
  padding: 1rem; margin-bottom: 1.25rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}
.section-title {
  margin: 0 0 .85rem 0; font-weight: 700; font-size: 1rem;
  color: var(--muted); text-transform: uppercase; letter-spacing: .5px;
}

.data-table { width: 100%; border-collapse: collapse; font-size: .9rem; }
.data-table thead th {
  background: var(--fill-soft); font-weight: 600; padding: .6rem .7rem;
  border: 1px solid var(--line); text-align: center; color: var(--ink);
}
.data-table tbody td {
  border: 1px solid var(--line); padding: .55rem .7rem; text-align: center;
}
.data-table tbody tr:nth-child(odd) { background: #fcfcfc; }
.data-table tbody tr:hover { background: #f1f3f5; }
.num { text-align: right; font-variant-numeric: tabular-nums; }
</style>

<div class="container py-4">
  <div class="page-header">
    <h4 class="page-title">Detalle de Orden de Venta</h4>
    <a href="{{ request.GET.next|default:request.META.HTTP_REFERER|default:'#' }}" class="ghost-btn">
      <i class="fas fa-arrow-left"></i> Volver
    </a>
  </div>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% else %}
    <!-- Datos generales -->
    <div class="card">
      <h5 class="section-title">Datos Generales</h5>
      <table class="table table-bordered table-sm">
        <tr><th>N° Documento</th><td>{{ ov.DocNum }}</td></tr>
        <tr><th>Fecha</th><td>{{ ov.DocDate }}</td></tr>
        <tr><th>Vencimiento</th><td>{{ ov.DocDueDate }}</td></tr>
        <tr><th>Cliente</th><td>{{ ov.CardCode }} — {{ ov.CardName }}</td></tr>
        <tr><th>Vendedor</th><td>{{ ov.Vendedor }}</td></tr>
        <tr><th>Total Neto</th><td class="num">$ {{ ov.TotalNeto|puntos_miles }}</td></tr>
        <tr><th>Moneda</th><td>{{ ov.DocCur }}</td></tr>
      </table>
    </div>

    <!-- Detalle de líneas -->
    <div class="card">
      <h5 class="section-title">Detalle de Líneas</h5>
      {% if detalle_items %}
        <div class="table-responsive">
          <table class="data-table">
            <thead>
              <tr><th>Línea</th><th>Item</th><th>Descripción</th><th>Cantidad</th><th>Pendiente</th></tr>
            </thead>
            <tbody>
              {% for item in detalle_items %}
              <tr>
                <td>{{ item.LineNum }}</td>
                <td>{{ item.ItemCode }}</td>
                <td>{{ item.Dscription }}</td>
                <td class="num">{{ item.Quantity|puntos_miles }}</td>
                <td class="num">{{ item.OpenQty|puntos_miles }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted">No hay detalle disponible para esta orden de venta.</p>
      {% endif %}
    </div>
  {% endif %}
</div>
{% endblock %}
