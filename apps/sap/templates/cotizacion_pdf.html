<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Cotización {{ quotation.DocNum }}</title>

<style>
/* ======== PAGINACIÓN REAL (FUNCIONA SIEMPRE) ======== */
@page {
    size: A4;
    margin: 8mm 10mm 22mm 10mm;
}

/* Contenedor fijo para el nº de página */
.page-number {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 18px;
    text-align: center;
    font-size: 10px;
    color: #111;
}

/* Texto */
.page-number:after {
    content: "Página " counter(page) " de " counter(pages);
}



body{font-family:Helvetica,Arial,sans-serif;color:#111;margin:0;font-size:11px;-webkit-print-color-adjust:exact;print-color-adjust:exact;}
thead{display:table-header-group;}
tr{page-break-inside:avoid;}

.sheet{width:96%;margin:0 auto;margin-top:-8px;}

.row{display:flex;gap:8px;margin-top:-2px;}
.col{display:flex;flex-direction:column;gap:6px;}

.box{
    border:2px solid #111;
    border-radius:3px;
    padding:8px 12px;
    background:#fff;
}

.tight p{margin:2px 0;line-height:1.15;}
.label{font-weight:700;}
.boldcaps{text-transform:uppercase;font-weight:700;}
.muted{color:#333;font-size:10.3px;}

.hdrL{flex:1;}
.hdrR{flex:0 0 28%;}

.hdr-logos{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-bottom:2px;
}

.logo-marsella,.logo-ggh{
    height:58px;
    object-fit:contain;
}

.logo-ggh{
    margin-left:80px;
    margin-top:-2px;
}

.hdr-info{
    display:grid;
    grid-template-columns:1.4fr 1fr;
    margin-top:0;
    row-gap:0;
}

.hdr-left p,.hdr-right p{
    margin:1px 0;
    line-height:1.15;
}

.hdr-right{
    text-align:right;
    padding-left:10px;
}

.ggh-box{
    flex:1;
    display:flex;
    justify-content:flex-end;
    padding-right:0;
}

.midL{flex:1;}

.midR{
    flex:0 0 28%;
    margin-top:-110px;
    gap:12px;
}

.midR .box:nth-child(2){
    margin-top:25px;
}

.midL .box{
    margin-top:6px;
}

.divider{
    border-top:3px solid #111;
    margin:6px 0;
}

table.items{
    width:100%;
    border-collapse:collapse;
    font-size:11px;
    margin-top:-10px;
}

table.items th{
    border-bottom:2px solid #111;
    padding:19px 5px;
    font-weight:700;
    text-align:left;
}

table.items td{
    border-bottom:1px solid #bcbcbc;
    padding:20px 5px;
    vertical-align:top;
}

.desc-extra{
    font-size:10px;
    margin-top:1px;
    color:#333;
}

.bottom{
    display:flex;
    gap:8px;
    align-items:flex-end;
    margin-top:15px;
}

.coment{flex:1 1 60%;}
.coment .box{min-height:70px;}

.firma{
    text-align:center;
    flex:1 1 22%;
}

.firma .line{
    width:180px;
    margin:18px auto 4px;
    border-top:2px solid #111;
}

.totales{
    flex:0 0 34%;
}

.totales table{
    width:100%;
    border-collapse:collapse;
}

.totales td{
    padding:2px 0;
    font-size:11px;
}

.totales .lbl{font-weight:700;}
.totales .val{text-align:right;}
.totales .mon{width:32px;padding-left:4px;}

.total-row{
    border-top:2px solid #111;
}

/* ===== LOGOS FOOTER SIN TAPAR PAGINACIÓN ===== */
.footer-logos{
    position: fixed;
    bottom: 28px;    /* deja espacio para la paginación */
    width: 100%;
    text-align: center;
}

.footer-logos img{
    height:30px;
    margin:0 10px;
    object-fit:contain;
}

.page{page-break-after:always;}
.page:last-child{page-break-after:auto;}
</style>

</head>

<body>

<!-- Paginación que SIEMPRE aparece -->
<div class="page-number"></div>

<div class="sheet">

{% for page in pages %}
<div class="page">

{% if forloop.first %}
<!-- HEADER -->
<div class="row">
<div class="hdrL">
<div class="box">
<div class="hdr-logos">
<div style="flex:1;display:flex;justify-content:flex-start;">
<img src="/static/img/MARSELLA_4.png" class="logo-marsella">
</div>
<div class="ggh-box">
<img src="/static/img/ggh.png" class="logo-ggh">
</div>
</div>

<div class="hdr-info">
<div class="hdr-left">
<p class="boldcaps">MARSELLA SPA</p>
<p>79.996.420-1</p>
<p>FERRETERÍA Y ALQUILER DE<br>MAQUINARIAS Y EQUIPOS</p>
<p class="boldcaps">CASA MATRIZ:</p>
<p>AV.ESPAÑA 2501, BATUCO, LAMPA, SANTIAGO</p>
<p class="boldcaps">SUCURSAL NORTE:</p>
<p>EL QUISCO 678, ANTOFAGASTA</p>
</div>

<div class="hdr-right">
<p class="boldcaps">TELÉFONO:</p>
<p>(56) 2 23539700</p>
<p class="boldcaps">EMAIL:</p>
<p>ventas@ggh.cl</p>
<p class="boldcaps">WEB:</p>
<p>www.ggh.cl</p>
<p>www.ferreteriamarsella.cl</p>
</div>
</div>

</div>
</div>

<div class="hdrR">
<div class="box">
<p class="label">COTIZACIÓN N° {{ quotation.DocNum }}</p>
<p>Realizada el: <span class="label">{{ quotation.DocDate_fmt }}</span></p>
</div>
</div>
</div>

<div class="row mt8">
<div class="midL">
<div class="box tight">
<p class="label">Señor (es)</p>
<p class="label" style="text-transform:uppercase">{{ quotation.CardName }}</p>
<p><span class="label">R.U.T.:</span> {{ quotation.FederalTaxID }}</p>
<p><span class="label">Dirección:</span> {{ quotation.Address }}</p>
<p><span class="label">Teléfono:</span> {{ quotation.Phone1|default:"-" }}</p>
<p><span class="label">Solicitado Por :</span> {{ quotation.SolicitadoPor|default:"-" }}</p>
</div>
</div>

<div class="midR col">
<div class="box tight">
<p class="label">Ref. Cliente:</p>
<p>{{ quotation.NumAtCard|default:"" }}</p>
<p><span class="label">Validez:</span> {{ quotation.DocDueDate_fmt }}</p>
<p><b>Forma de Pago:</b> {{ quotation.FormaPago }}</p>
<p>{{ quotation.SalesPersonName }}</p>
</div>
<div class="box tight">
<p class="label">Métodos de pago:</p>
<p>Transferencia</p><p>Khipu</p><p>WebPay</p><p>Mercado Pago</p><p>Email: cobranzas@ggh.cl</p>
</div>
</div>
</div>

<div class="divider"></div>
{% endif %}

<!-- TABLA ITEMS -->
<table class="items">
<thead>
<tr>
<th>Código</th><th>Descripción</th><th>U.Med</th><th>Cant</th><th>Entrega (días)</th>
<th class="right">P.Unit</th><th class="right">Total</th>
</tr>
</thead>
<tbody>
{% for line in page %}
<tr>
<td>{{ line.ItemCode }}</td>
<td>{{ line.ItemDescription }}{% if line.U_ExtraDescription %}<div class="desc-extra">{{ line.U_ExtraDescription }}</div>{% endif %}</td>
<td>{{ line.MeasureUnit|default:"-" }}</td>
<td class="center">{{ line.Quantity }}</td>
<td class="center">{{ line.U_GGH_TIM|default:"-" }}</td>
<td class="right">{{ line.UnitPrice_fmt }}</td>
<td class="right">{{ line.LineTotal_fmt }}</td>
</tr>
{% endfor %}
</tbody>
</table>

{% if forloop.last %}
<div class="bottom">
<div class="coment">
<p class="label">Comentarios:</p>
<div class="box"></div>
</div>

<div class="firma">
<div class="line"></div>
<p class="muted">Aceptación Cliente</p>
</div>

<div class="totales">
<div class="box">
<table>
<tr><td class="lbl">Neto:</td><td class="val">{{ neto }}</td><td class="mon">CLP</td></tr>
{% if descuento_percent > 0 %}
<tr><td class="lbl">Desc (%):</td><td class="val">{{ descuento_percent_str }}</td><td></td></tr>
{% endif %}
<tr><td class="lbl">Descuento:</td><td class="val">{{ descuento }}</td><td class="mon">CLP</td></tr>
<tr><td class="lbl strong">TOTAL NETO:</td><td class="val strong">{{ total_neto }}</td><td class="mon strong">CLP</td></tr>
<tr><td class="lbl">IVA:</td><td class="val">{{ iva }}</td><td class="mon">CLP</td></tr>
<tr class="total-row"><td class="lbl strong">TOTAL:</td><td class="val strong">{{ total }}</td><td class="mon strong">CLP</td></tr>
</table>
</div>
</div>
</div>
{% endif %}

<!-- FOOTER LOGOS -->
<div class="footer-logos">
<img src="/static/img/logomarsellafooter.png">
<img src="/static/img/logofixman.png">
<img src="/static/img/logoglanz.png">
<img src="/static/img/logozebrik.png">
<img src="/static/img/logobufalo.png">
<img src="/static/img/logopools.png">
<img src="/static/img/logoasland.png">
</div>

</div>
{% endfor %}

</div>
</body>
</html>
