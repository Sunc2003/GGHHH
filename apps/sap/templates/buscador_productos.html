{% extends "base.html" %}
{% load custom_filters %}

{% block extra_css %}
<style>
  :root{
    --ink:#111; --muted:#555; --line:#dcdcdc; --fill:#fff; --fill-soft:#f7f7f7;
  }
  body{ color:var(--ink); background:#fff; }
  .search-card{
    border:1px solid var(--line); background:var(--fill);
    padding:1rem; margin-bottom:1rem;
  }
  .form-control, .form-check-input{
    border:1px solid #000; background:#fff; color:#000;
    border-radius:0; /* cuadrado */
  }
  .btn-primary{ background:#000; border:1px solid #000; color:#fff; border-radius:0; }
  .btn-primary:hover{ background:#333; border-color:#333; }
  .btn-secondary{ border-radius:0; }

  .table{ width:100%; border-collapse:collapse; background:var(--fill); }
  .table th, .table td{ border:1px solid var(--line); padding:.6rem .7rem; vertical-align:middle; }
  .table thead th{ background:var(--fill-soft); font-weight:700; text-align:center; }
  .table tbody tr:nth-child(odd){ background:#fafafa; }
  .num{ text-align:right; font-variant-numeric:tabular-nums; }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">

  <div class="search-card">
    <form method="get" class="row g-2 align-items-center">
      <div class="col-md-4 col-12">
        <input type="text" name="q" placeholder="Buscar producto..."
               value="{% firstof termino request.GET.q '' %}" class="form-control">
      </div>
      <div class="col-auto form-check ms-2">
        <input type="checkbox" name="con_stock" id="con_stock" class="form-check-input"
               {% if filtrar_stock or request.GET.con_stock %}checked{% endif %}>
        <label for="con_stock" class="form-check-label">Solo con stock</label>
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary">
          <i class="fa fa-search"></i> Buscar
        </button>
      </div>

      <!-- Botón para limpiar búsqueda -->
      <div class="col-auto">
        <a href="{% url 'buscar_productos_ui' %}" class="btn btn-secondary">
          <i class="fa fa-times"></i> Limpiar
        </a>
      </div>
    </form>
  </div>

  {% if request.GET %}
    {% if resultados %}
      <table class="table align-middle">
        <thead>
          <tr>
            <th>Código</th>
            <th>Descripción</th>
            <th class="num">Stock Total</th>
            <th class="num">PMV</th>
            <th>Detalles</th>
          </tr>
        </thead>
        <tbody>
          {% for producto in resultados %}
            <tr>
              <td>{{ producto.Codigo }}</td>
              <td>{{ producto.Descripcion }}</td>
              <td class="num">{{ producto.StockTotal|puntos_miles }}</td>
              <td class="num">$ {{ producto.PrecioMinVta|puntos_miles }}</td>
              <td class="text-center">
                <a href="{% url 'obtener_detalle_producto' producto.Codigo %}?{{ request.GET.urlencode }}"
                   class="btn btn-primary btn-sm" style="min-width:88px">
                  Ver detalles
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="alert alert-warning" style="border:1px solid var(--line); border-radius:0;">
        No hay resultados para tu búsqueda.
      </p>
    {% endif %}
  {% endif %}
</div>
{% endblock %}
