{% extends "base.html" %}
{% load static %}
{% load custom_filters %}  {# Cargamos los filtros personalizados #}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-3">Buscador de Productos</h3>

  <form method="get" class="mb-4 row g-2 align-items-center">
    <div class="col-auto">
      <input type="text" name="q" placeholder="Buscar producto..." value="{{ termino }}" class="form-control">
    </div>
    <div class="col-auto form-check">
      <input type="checkbox" name="con_stock" id="con_stock" class="form-check-input" {% if filtrar_stock %}checked{% endif %}>
      <label for="con_stock" class="form-check-label">Solo con stock</label>
    </div>
    <div class="col-auto">
      <button type="submit" class="btn btn-primary">Buscar</button>
    </div>
  </form>
  
  {% if resultados %}
    <table class="table table-striped table-bordered align-middle">
      <thead class="table-dark text-center">
        <tr>
          <th>Código</th>
          <th>Descripción</th>
          <th>Stock Total</th>
          <th>PMV</th>
          <th>Detalles</th>
        </tr>
      </thead>
      <tbody>
        {% for producto in resultados %}
          <tr>
            <td>{{ producto.Codigo }}</td>
            <td>{{ producto.Descripcion }}</td>
            <td class="text-end">{{ producto.StockTotal|puntos_miles }}</td>
            <td class="text-end">${{ producto.PrecioMinVta|floatformat:0|puntos_miles }}</td>
            <td class="text-center">
              <a href="{% url 'obtener_detalle_producto' producto.Codigo %}" class="btn btn-info btn-sm">Ver detalles</a>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="alert alert-warning">No hay resultados para tu búsqueda.</p>
  {% endif %}
</div>
{% endblock %}
